<style>
    .admonition-padding {
        border-left: .25em solid;
        padding-left: 20px;
        font-style: italic;
    }
    .input-group__control {
        font-family: "Courier New", Courier, monospace;
    }
    .bold-red {
        padding: unset;
        color: red;
        font-weight: bold;
        background-color: unset;
    }
    .modal-content>div {
        width: unset;
    }
    p {
        line-height: 1.7;
    }
    li {
        line-height: 1.3;
    }
</style>
<section id="step-summary" class="step step--intro">
    <div class="step__number step__number--intro">
        <span>Overview</span>
    </div>
    <h1>React with Event-Driven Ansible (EDA)</h1>
    <p>In this lab, you will learn how to leverage the Event Streams API via the crowdstrike.falcon.eventstreams Event-Driven Ansible (EDA) source
        to monitor and respond to CrowdStrike Falcon events in near real-time*.</p>
    <p class="admonition-padding">Please note that events are not guaranteed to be delivered in real-time. The time it takes for an event to be delivered can vary based on
        the current load on the CrowdStrike Event Streams service along with other factors.</p>
    <p>By the end of this lab, you will be able to:</p>
    <ul style="text-align: left;">
        <li>Understand the potential for using EDA to monitor and respond to CrowdStrike Falcon events</li>
        <li>Create rules and conditions to filter events</li>
        <li>Respond to events using Ansible playbooks</li>
    </ul>
    <p>Lab location: <b>~/labs/lab3</b></p>
</section>

<section id="step-01" class="step">
    <div class="step__number">
        <span>Step / 01</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s1-1.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <p>Change directory to the <b>lab3</b> directory</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">cd ~/labs/lab3</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="step-structure" class="step">
    <div class="step__number">
        <span>Lab Structure</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6" style="width: unset;">
            <p style="
            border-left: .25em solid;
            padding: inherit;
            font-style: italic;
            ">Please note that events are not guaranteed to be delivered in real-time. The time it takes for an event to be delivered can vary based on
                the current load on the CrowdStrike Event Streams service along with other factors.</p>
            <img style="width: 400px;" class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3soverview.png" alt="">
            <p style="margin-top: revert;">This lab consists of a <b>rulebooks</b> directory that contains two EDA rulebooks that will be used to demonstrate how to monitor and
                respond to CrowdStrike Falcon events using EDA. The <b>playbooks</b> directory contains Ansible playbooks that will show high-level examples
                of how to respond to events. There is also a <b>logs</b> directory used to store the logs generated by the host-contain.yml playbook.</p>
            <p class="admonition-padding">Throughout this lab we will use the <b>tee</b> command to review long output since our lab vm's have a small buffer :(</p>
        </div>
    </div>
</section>

<section id="step-rulebooks" class="step">
    <div class="step__number">
        <span>Rulebooks</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6" style="width: unset;">
            <p class="admonition-padding">EDA Rulebooks are not to be confused with Ansible playbooks. Even though they follow a similar structure, Rulebooks operate separately from Ansible core itself.</p>

            <p>Rulebooks in EDA are YAML files that define how your system should respond to events. They are broken out into three main sections:</p>
            <ul>
                <li><b style="padding: unset;">Sources</b>: Define the sources of events that you want to monitor</li>
                <li><b style="padding: unset;">Rules</b>: Define the conditions that must be met for an event to trigger a response</li>
                <li><b style="padding: unset;">Actions</b>: Define the actions that should be taken when an event meets the conditions defined in the rules</li>
            </ul>
            <p class="admonition-padding">For more information on rulebooks, see the
                <a href="https://ansible.readthedocs.io/projects/rulebook/en/latest/introduction.html#why-rulebooks" target="_blank">EDA documentation</a>.
            </p>
        </div>
    </div>
</section>

<section id="step-02" class="step">
    <div class="step__number">
        <span>Step / 02</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s1.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <p>Now that we have a basic understanding of rulebooks, let's take a look at the <b>detection-example.yml</b> rulebook in the rulebooks directory.</p>

            <p>Review the contents of the <b>detection-example.yml</b> rulebook:</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">cat rulebooks/detection-example.yml</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p style="margin-top: revert;">You can see that for the source, we are using the <b>crowdstrike.falcon.eventstreams</b> source. This source will allow us to
                monitor CrowdStrike Falcon events by tapping into the Event Streams API.</p>
            <p class="admonition-padding">For more information on the crowdstrike.falcon.eventstreams source, see the
                <a href="https://github.com/CrowdStrike/ansible_collection_falcon/blob/main/docs/crowdstrike.falcon.eventstream.md" target="_blank">documentation</a>.
            </p>
            <p>The <b>rule</b> defined in this rulebook is looking for any event that matches the alias of your lab environment. This is defined in the conditions section of the rulebook.</p>
            <p>The <b>action</b> here is using the debug action to print out a formatted message of any event that matches the conditions defined in the rule.</p>
        </div>
    </div>
</section>

<section id="step-03" class="step">
    <div class="step__number">
        <span>Step / 03</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6 order-2">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s2.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Running the Detection Example Rulebook</h3>
            <p>Let's run the <b>detection-example.yml</b> rulebook to see how it works:</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">ansible-rulebook -i inventory -r rulebooks/detection-example.yml -E FALCON_CLIENT_ID,FALCON_CLIENT_SECRET -v | tee output.txt</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p class="admonition-padding" style="margin-top: revert;">Recall that this is different from running an Ansible playbook. To pass in the required environment variables, we are using the <b>-E</b> flag
                followed by the environment variables that need to be set.</p>
            <p>At this point, we shouldn't see any output. This is because we haven't triggered any events that match the conditions defined in the rulebook.</p>
            <p>Move on to the next step.</p>
        </div>
    </div>
</section>

<section id="step-04" class="step">
    <div class="step__number">
        <span>Step / 04</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s3.gif" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Triggering an Event</h3>
            <p>Hop over to your <b>sketchy-cat1</b> vm and run the following command to generate an event that matches the conditions defined in the rulebook.</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">bash crowdstrike_test_low > /dev/null 2>&1</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p class="admonition-padding" style="margin-top: revert;">This command generates an Overwatch severity level low event that matches the conditions defined in the rulebook.</p>
            <p>Now go back to the <b>ansible</b> vm and let's wait for the event to be delivered. Once the event is delivered, you should see the event printed out in the terminal.</p>
            <p class="admonition-padding">Recall that this is not real-time and the time it takes for an event to be delivered can vary.</p>
            <p>Cancel the rulebook execution by pressing <b>Ctrl + C</b> before proceeding to the next step.</p>
        </div>
    </div>
</section>

<section id="step-05" class="step">
    <div class="step__number">
        <span>Step / 05</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6 order-2">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s4-1.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Crank it up a Notch</h3>
            <p>Now that we have seen an example rulebook and how it works, let's take a more practical approach to responding to the Falcon security events.</p>
            <p>Review the contents of the <b>detection-demo.yml</b> rulebook:</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">cat rulebooks/detection-demo.yml</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p class="admonition-padding" style="margin-top: revert;">For more information surrounding Event Types, see the following
                <a href="https://falcon.crowdstrike.com/login/?unilogin=true&amp;next=/documentation/page/d88d9ed6/streaming-api-event-dictionary" target="_blank">CrowdStrike documentation</a>.
            </p>
            <p>This rulebook is similar to the <b>detection-example.yml</b> rulebook, but it has a few additional conditions defined in the rule section and an extra Event Type to include.</p>
            <p>In the next steps, we'll dive deeper into this rulebook.</p>
        </div>
    </div>
</section>

<section id="step-06" class="step">
    <div class="step__number">
        <span>Step / 06</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s5-1.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Rule 1</h3>
            <p>What we are defining now is that we only want to respond to detection events that are:</p>
            <ol>
                <li>From our lab environment</li>
                <li>And have a severity greater than a Medium severity level</li>
            </ol>
            <br>
            <p style="margin-top: revert;">The <b class="bold-red">action</b> defined if the <b class="bold-red">condition</b> matches is to run the <b style="padding: unset">host-contain.yml</b> playbook
            located in the playbooks directory. We are are also passing in extra variables to our playbook directly from the events as they are processed.</p>
            <p class="admonition-padding">Passing extra_vars is not mandatory as you can still use the entire events payload from the playbook perspective, however it does make things easier to
            understand for both rulebooks and playbooks.</p>
        </div>
    </div>
</section>

<section id="step-07" class="step">
    <div class="step__number">
        <span>Step / 07</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6 order-2">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s6-2.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Rule 1: Playbook</h3>
            <p>Review the contents of the <b>host-contain.yml</b> rulebook:</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">less playbooks/host-contain.yml</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p style="margin-top: revert;">This playbook does the following: </p>
            <ol>
                <li>Transforms the event data into easily readable JSON</li>
                <li>Writes relevant security details relating to the event to a log file</li>
                <li>Attempts to Host Contain the asset by utilizing the <b style="padding: unset">crowdstrike.falcon.host_contain</b> Ansible module</li>
                <li>Logs the status of the containment</li>
            </ol>
        </div>
    </div>
</section>

<section id="step-08" class="step">
    <div class="step__number">
        <span>Step / 08</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s7-1.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Rule 2</h3>
            <p>We also have another rule that is watching for containment events. These events belong to the <b class="bold-red">UserActivityAuditEvent</b> event type.</p>
            <p>The <b class="bold-red">action</b> defined if the <b class="bold-red">condition</b> matches is to run the <b style="padding: unset">debug-containment.yml</b> playbook
            located in the playbooks directory. As with the other rule, we are passing in extra variables to our playbook directly from the events as they are processed.</p>
        </div>
    </div>
</section>

<section id="step-09" class="step">
    <div class="step__number">
        <span>Step / 09</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6 order-2">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s8-1.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Rule 2: Playbook</h3>
            <p>Review the contents of the <b>debug-containment.yml</b> rulebook:</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">less playbooks/debug-containment.yml</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p style="margin-top: revert;">This playbook does the following: </p>
            <ol>
                <li>Sets a couple of facts:
                    <ol style="list-style-type: disclosure-open;">
                        <li>A formatted timestamp using the <b class="bold-red">utc_timestamp</b> passed-in variable</li>
                        <li>A string dictating which type of containment was requested based on the <b class="bold-red">operation</b> passed-in variable</li>
                    </ol>
                </li>
                <li>Prints out a formatted message to STDOUT</li>
            </ol>
        </div>
    </div>
</section>

<section id="step-10" class="step">
    <div class="step__number">
        <span>Step / 10</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s9.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Running the Detection Demo Rulebook</h3>
            <p>Let's run the <b>detection-demo.yml</b> rulebook to see it all come together:</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">ansible-rulebook -i inventory -r rulebooks/detection-demo.yml -E FALCON_CLIENT_ID,FALCON_CLIENT_SECRET -v | tee output.txt</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p class="admonition-padding" style="margin-top: revert;">Recall that this is different from running an Ansible playbook. To pass in the required environment variables, we are using the <b>-E</b> flag
                followed by the environment variables that need to be set.</p>

            <p>Move on to the next step to trigger an event!</p>
        </div>
    </div>
</section>

<section id="step-11" class="step">
    <div class="step__number">
        <span>Step / 11</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6 order-2">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s10.gif" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Triggering an Event</h3>
            <p>Hop over to your <b>sketchy-cat1</b> vm and run the following command to generate an event that matches the conditions defined in the rulebook.</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">bash crowdstrike_test_high > /dev/null 2>&1</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p class="admonition-padding" style="margin-top: revert;">This command generates an Overwatch severity level High event that matches the conditions defined in the rulebook.</p>
            <p>Now go back to the <b>ansible</b> vm and let's wait for the event to be delivered. Once the event is delivered, you should see the rules executed.</p>
            <p class="admonition-padding">Recall that this is not real-time and the time it takes for an event to be delivered can vary.</p>
            <p>Cancel the rulebook execution by pressing <b>Ctrl + C</b> before proceeding to the next step.</p>
        </div>
    </div>
</section>

<section id="step-12" class="step">
    <div class="step__number">
        <span>Step / 12</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s11-1.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Review the Log</h3>
            <p>Let's checkout the logfile that was generated by the <b>host_contain.yml</b> Ansible playbook:</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">less logs/*sketchy-cat1*.log</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p style="margin-top: revert;">You can see how leveraging a simple playbook to react and create relevant data that a security persona would love to have
                automated is easy to accomplish with EDA. Start to imagine the different ways you would automate how you react to security events powered by CrowdStrike!</p>
        </div>
    </div>
</section>

<section id="step-13" class="step">
    <div class="step__number">
        <span>Step / 13</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6 order-2">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s12.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Verify Host Containment</h3>
            <div>
                <a class="btn btn-lg btn-danger round-both mb-1 cloud_account_id" rel="noopener2 noreferrer2" target="crowdstrike" data-template="https://falcon.crowdstrike.com/activity-v2/detections?filter=hostname%3A%27{{alias}}-sketchy-cat1%27%2Bseverity%3A%27High%27" href="#">Open The Detection</a>
            </div>
            <p>Click on the detection and browse around. Notice on the right hand pane, if you scroll down to <b>Host</b> you will see the host is currently <b class="bold-red">Contained</b>!</p>
            <p>You can also try to see if you have access to your <b>sketchy-cat1</b> vm.</p>
        </div>
    </div>
</section>

<section id="step-14" class="step">
    <div class="step__number">
        <span>Step / 14</span>
    </div>
    <div class="grid grid-bleed-y">
        <div class="col-6">
            <img class="enlargeable" src="/portal/images/testdrive/devrel/ansible-s3s13.png" width="100%" alt="">
        </div>
        <div class="col-6">
            <h3>Bring back Sketchy-Cat1</h3>
            <p>Since we don't have Admin access on the Falcon console - we'll need to bring sketchy-cat1 back with a built-in helper alias.</p>
            <p>Run the following command to lift the containment on <b>sketchy-cat1</b>:</p>
            <div class="grid copy-parent">
                <div class="col-auto">
                    <div class="input-group">
                        <span class="input-group__accent"></span>
                        <textarea readonly class="input-group__control copy-text" type="text" rows="1">bring-sketchy-back</textarea>
                        <span class="input-group__accent"></span>
                    </div>
                </div>
                <div class="col-shrink">
                    <a href="#" class="btn btn--alt btn--small btn--square copy-link" data-message="Copied!">
                        <img src="/dist/img/icon-copy.svg" width="20">
                    </a>
                </div>
            </div>
            <p style="margin-top: revert;">Double check on the Falcon console that we have lifted the containment, and also double check that the <b>sketchy-cat1</b> vm instance is back!</p>
        </div>
    </div>
</section>

<section id="step-complete" class="step step--complete">
    <h2><span class="text-primary">Summary</span></h2>
    <p>By this point, you can likely envision the number of possibilities Ansible offers for event response automation. The power of Ansible lies
    in its versatility and extensive module library, that could allow you to take actions such as:</p>
    <ul style="text-align: left;">
        <li>Send instant notifications via Slack or other messaging platforms</li>
        <li>Automatically open ServiceNow tickets for incident tracking</li>
        <li>Create or modify firewall rules in real-time</li>
        <li>Interact with various cloud services and infrastructure components</li>
    </ul>
    <p style="margin-top: revert;">These capabilities significantly extend your incident response toolkit beyond the native features of the Falcon platform. Ansible's integration potential
    allows you to create sophisticated, multi-step workflows that can:</p>
    <ul style="text-align: left;">
        <li>Orchestrate complex remediation processes</li>
        <li>Automate compliance checks and reporting</li>
        <li>Facilitate seamless interaction between disparate systems</li>
    </ul>
    <p style="margin-top: revert;">In this scenario, we've shown how leveraging Ansible in conjunction with the Falcon platform, you can build a robust, customized security ecosystem that's
    tailored to your organizations specific needs and infrastructure!</p>
    <p>In the final scenario, we'll dive into some of what the CrowdStrike Falcon Ansible collection has to offer.</p>
    <a href="#" class="btn btn--alt nav_button forward">
        <img src="/dist/img/carousel-next.svg" width="20">
    </a>
    <p class="small uppercase">Next Scenario</p>
</section>
